name: Upload XoDos full versions

on:
  workflow_dispatch:
    inputs:
      version_tag:
        description: 'Version tag (6.0.0)'
        required: true
        default: '6.0.0'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Git Tag
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git tag ${{ github.event.inputs.version_tag }}
          git push origin ${{ github.event.inputs.version_tag }}

      - name: Download Main APK
        run: |
          pip install gdown
          gdown "1K4Y5eO3aVuF3vvLFSS5e2zbdn-ZuILgp" -O XoDos-${{ github.event.inputs.version_tag }}-full_arm64-v8a.apk || exit 1

      - name: Download Additional Files
        run: |
          gdown "1D7X64n1rlszrmDg_uMaG0QL0109fJdPE" -O xodos_proot-6.0.tar.xz || exit 1
          gdown "1IqSnMIVZzQ_RTwN_s-qnAGB9p8dpI9jp" -O xodos_steam-lite.tar.xz || exit 1

      - name: Generate MD5 Checksums
        id: md5
        run: |
          echo "### File checksums:" > checksums.txt
          for f in XoDos-${{ github.event.inputs.version_tag }}-full_arm64-v8a.apk xodos_proot-6.0.tar.xz xodos_steam-lite.tar.xz; do
            md5sum "$f" | awk '{print "- **"$2"** â†’ `"$1"`"}' >> checksums.txt
          done
          echo "md5_list<<EOF" >> $GITHUB_ENV
          cat checksums.txt >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Create Release with Both Files
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.event.inputs.version_tag }}
          name: XoDos ${{ github.event.inputs.version_tag }}
          files: |
            XoDos-${{ github.event.inputs.version_tag }}-full_arm64-v8a.apk
            xodos_proot-6.0.tar.xz
            xodos_steam-lite.tar.xz
          body: |
            New XoDos release for arm64

            What's new?
            - 

            ${{ env.md5_list }}

           
            **Credits:**
            Team: @xodiosxðŸ‡¾ðŸ‡ª & @DevArysðŸ‡¨ðŸ‡´ & @Mondo67244ðŸ‡²ðŸ‡« & @Aurora0yðŸ‡§ðŸ‡· & @Chest1902ðŸ‡§ðŸ‡© & @jiaxinchen-max ðŸ‡¨ðŸ‡³  & @Snap888ðŸ‡·ðŸ‡º
            Logo designer: @xl_v6/ashenðŸ‡®ðŸ‡¶

            **Support:**
            Telegram: https://t.me/xodemulatorr
            Discord: https://discord.gg/d2ChVhPfnF

            Thank you for choosing XoDos by xodios M.aleiwÂ©2025
